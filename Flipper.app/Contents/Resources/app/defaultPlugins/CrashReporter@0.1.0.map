{"version":3,"sources":["__prelude__","/data/sandcastle/boxes/trunk-hg-fbcode-fbsource/xplat/flipper-public/static/node_modules/metro/src/lib/polyfills/require.js","/data/sandcastle/boxes/trunk-hg-fbcode-fbsource/xplat/flipper-public/src/plugins/crash_reporter/index.js","/data/sandcastle/boxes/trunk-hg-fbcode-fbsource/xplat/flipper-public/src/plugins/crash_reporter/node_modules/unicode-substring/index.js"],"sourcesContent":["var __DEV__=false,__BUNDLE_START_TIME__=this.nativePerformanceNow?nativePerformanceNow():Date.now(),process=this.process||{};process.env=process.env||{};process.env.NODE_ENV=\"production\";","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @polyfill\n *\n * @format\n */\n\n\"use strict\";\n\n/* eslint-disable no-bitwise */\n\nglobal.__r = metroRequire;\nglobal.__d = define;\nglobal.__c = clear;\n\nvar modules = clear();\n\n// Don't use a Symbol here, it would pull in an extra polyfill with all sorts of\n// additional stuff (e.g. Array.from).\nvar EMPTY = {};\nvar _ref = {},\n  hasOwnProperty = _ref.hasOwnProperty;\n\nfunction clear() {\n  modules =\n    typeof __NUM_MODULES__ === \"number\"\n      ? Array(__NUM_MODULES__ | 0)\n      : Object.create(null);\n\n  // We return modules here so that we can assign an initial value to modules\n  // when defining it. Otherwise, we would have to do \"let modules = null\",\n  // which will force us to add \"nullthrows\" everywhere.\n  return modules;\n}\n\nif (__DEV__) {\n  var verboseNamesToModuleIds = Object.create(null);\n  var initializingModuleIds = [];\n}\n\nfunction define(factory, moduleId, dependencyMap) {\n  if (modules[moduleId] != null) {\n    if (__DEV__) {\n      // (We take `inverseDependencies` from `arguments` to avoid an unused\n      // named parameter in `define` in production.\n      var inverseDependencies = arguments[4];\n\n      // If the module has already been defined and the define method has been\n      // called with inverseDependencies, we can hot reload it.\n      if (inverseDependencies) {\n        global.__accept(moduleId, factory, dependencyMap, inverseDependencies);\n      } else {\n        console.warn(\n          \"Trying to define twice module ID \" + moduleId + \" in the same bundle\"\n        );\n      }\n    }\n\n    // prevent repeated calls to `global.nativeRequire` to overwrite modules\n    // that are already loaded\n    return;\n  }\n  modules[moduleId] = {\n    dependencyMap: dependencyMap,\n    factory: factory,\n    hasError: false,\n    importedAll: EMPTY,\n    importedDefault: EMPTY,\n    isInitialized: false,\n    publicModule: { exports: {} }\n  };\n  if (__DEV__) {\n    // HMR\n    modules[moduleId].hot = createHotReloadingObject();\n\n    // DEBUGGABLE MODULES NAMES\n    // we take `verboseName` from `arguments` to avoid an unused named parameter\n    // in `define` in production.\n    var _verboseName = arguments[3];\n    if (_verboseName) {\n      modules[moduleId].verboseName = _verboseName;\n      verboseNamesToModuleIds[_verboseName] = moduleId;\n    }\n  }\n}\n\nfunction metroRequire(moduleId) {\n  if (__DEV__ && typeof moduleId === \"string\") {\n    var _verboseName2 = moduleId;\n    moduleId = verboseNamesToModuleIds[_verboseName2];\n    if (moduleId == null) {\n      throw new Error('Unknown named module: \"' + _verboseName2 + '\"');\n    } else {\n      console.warn(\n        'Requiring module \"' +\n          _verboseName2 +\n          '\" by name is only supported for ' +\n          \"debugging purposes and will BREAK IN PRODUCTION!\"\n      );\n    }\n  }\n\n  //$FlowFixMe: at this point we know that moduleId is a number\n  var moduleIdReallyIsNumber = moduleId;\n\n  if (__DEV__) {\n    var initializingIndex = initializingModuleIds.indexOf(\n      moduleIdReallyIsNumber\n    );\n    if (initializingIndex !== -1) {\n      var cycle = initializingModuleIds\n        .slice(initializingIndex)\n        .map(function(id) {\n          return modules[id].verboseName;\n        });\n      // We want to show A -> B -> A:\n      cycle.push(cycle[0]);\n      console.warn(\n        \"Require cycle: \" +\n          cycle.join(\" -> \") +\n          \"\\n\\n\" +\n          \"Require cycles are allowed, but can result in uninitialized values. \" +\n          \"Consider refactoring to remove the need for a cycle.\"\n      );\n    }\n  }\n\n  var module = modules[moduleIdReallyIsNumber];\n\n  return module && module.isInitialized\n    ? module.publicModule.exports\n    : guardedLoadModule(moduleIdReallyIsNumber, module);\n}\n\nfunction metroImportDefault(moduleId) {\n  if (__DEV__ && typeof moduleId === \"string\") {\n    var _verboseName3 = moduleId;\n    moduleId = verboseNamesToModuleIds[_verboseName3];\n  }\n\n  //$FlowFixMe: at this point we know that moduleId is a number\n  var moduleIdReallyIsNumber = moduleId;\n\n  if (\n    modules[moduleIdReallyIsNumber] &&\n    modules[moduleIdReallyIsNumber].importedDefault !== EMPTY\n  ) {\n    return modules[moduleIdReallyIsNumber].importedDefault;\n  }\n\n  var exports = metroRequire(moduleIdReallyIsNumber);\n  var importedDefault =\n    exports && exports.__esModule ? exports.default : exports;\n\n  return (modules[moduleIdReallyIsNumber].importedDefault = importedDefault);\n}\n\nfunction metroImportAll(moduleId) {\n  if (__DEV__ && typeof moduleId === \"string\") {\n    var _verboseName4 = moduleId;\n    moduleId = verboseNamesToModuleIds[_verboseName4];\n  }\n\n  //$FlowFixMe: at this point we know that moduleId is a number\n  var moduleIdReallyIsNumber = moduleId;\n\n  if (\n    modules[moduleIdReallyIsNumber] &&\n    modules[moduleIdReallyIsNumber].importedAll !== EMPTY\n  ) {\n    return modules[moduleIdReallyIsNumber].importedAll;\n  }\n\n  var exports = metroRequire(moduleIdReallyIsNumber);\n  var importedAll = void 0;\n\n  if (exports && exports.__esModule) {\n    importedAll = exports;\n  } else {\n    importedAll = {};\n\n    // Refrain from using Object.assign, it has to work in ES3 environments.\n    if (exports) {\n      for (var _key in exports) {\n        if (hasOwnProperty.call(exports, _key)) {\n          importedAll[_key] = exports[_key];\n        }\n      }\n    }\n\n    importedAll.default = exports;\n  }\n\n  return (modules[moduleIdReallyIsNumber].importedAll = importedAll);\n}\n\nvar inGuard = false;\nfunction guardedLoadModule(moduleId, module) {\n  if (!inGuard && global.ErrorUtils) {\n    inGuard = true;\n    var returnValue = void 0;\n    try {\n      returnValue = loadModuleImplementation(moduleId, module);\n    } catch (e) {\n      global.ErrorUtils.reportFatalError(e);\n    }\n    inGuard = false;\n    return returnValue;\n  } else {\n    return loadModuleImplementation(moduleId, module);\n  }\n}\n\nvar ID_MASK_SHIFT = 16;\nvar LOCAL_ID_MASK = ~0 >>> ID_MASK_SHIFT;\n\nfunction unpackModuleId(moduleId) {\n  var segmentId = moduleId >>> ID_MASK_SHIFT;\n  var localId = moduleId & LOCAL_ID_MASK;\n  return { segmentId: segmentId, localId: localId };\n}\nmetroRequire.unpackModuleId = unpackModuleId;\n\nfunction packModuleId(value) {\n  return (value.segmentId << ID_MASK_SHIFT) + value.localId;\n}\nmetroRequire.packModuleId = packModuleId;\n\nvar hooks = [];\nfunction registerHook(cb) {\n  var hook = { cb: cb };\n  hooks.push(hook);\n  return {\n    release: function release() {\n      for (var i = 0; i < hooks.length; ++i) {\n        if (hooks[i] === hook) {\n          hooks.splice(i, 1);\n          break;\n        }\n      }\n    }\n  };\n}\nmetroRequire.registerHook = registerHook;\n\nfunction loadModuleImplementation(moduleId, module) {\n  if (!module && global.__defineModule) {\n    global.__defineModule(moduleId);\n    module = modules[moduleId];\n  }\n\n  var nativeRequire = global.nativeRequire;\n  if (!module && nativeRequire) {\n    var _unpackModuleId = unpackModuleId(moduleId),\n      _segmentId = _unpackModuleId.segmentId,\n      _localId = _unpackModuleId.localId;\n\n    nativeRequire(_localId, _segmentId);\n    module = modules[moduleId];\n  }\n\n  if (!module) {\n    throw unknownModuleError(moduleId);\n  }\n\n  if (module.hasError) {\n    throw moduleThrewError(moduleId, module.error);\n  }\n\n  // `metroRequire` calls into the require polyfill itself are not analyzed and\n  // replaced so that they use numeric module IDs.\n  // The systrace module will expose itself on the metroRequire function so that\n  // it can be used here.\n  // TODO(davidaurelio) Scan polyfills for dependencies, too (t9759686)\n  if (__DEV__) {\n    var Systrace = metroRequire.Systrace;\n  }\n\n  // We must optimistically mark module as initialized before running the\n  // factory to keep any require cycles inside the factory from causing an\n  // infinite require loop.\n  module.isInitialized = true;\n\n  var _module = module,\n    factory = _module.factory,\n    dependencyMap = _module.dependencyMap;\n\n  if (__DEV__) {\n    initializingModuleIds.push(moduleId);\n  }\n  try {\n    if (__DEV__) {\n      // $FlowFixMe: we know that __DEV__ is const and `Systrace` exists\n      Systrace.beginEvent(\"JS_require_\" + (module.verboseName || moduleId));\n    }\n\n    var _moduleObject = module.publicModule;\n\n    if (__DEV__) {\n      if (module.hot) {\n        _moduleObject.hot = module.hot;\n      }\n    }\n    _moduleObject.id = moduleId;\n\n    if (hooks.length > 0) {\n      for (var i = 0; i < hooks.length; ++i) {\n        hooks[i].cb(moduleId, _moduleObject);\n      }\n    }\n\n    // keep args in sync with with defineModuleCode in\n    // metro/src/Resolver/index.js\n    // and metro/src/ModuleGraph/worker.js\n    factory(\n      global,\n      metroRequire,\n      metroImportDefault,\n      metroImportAll,\n      _moduleObject,\n      _moduleObject.exports,\n      dependencyMap\n    );\n\n    // avoid removing factory in DEV mode as it breaks HMR\n    if (!__DEV__) {\n      // $FlowFixMe: This is only sound because we never access `factory` again\n      module.factory = undefined;\n      module.dependencyMap = undefined;\n    }\n\n    if (__DEV__) {\n      // $FlowFixMe: we know that __DEV__ is const and `Systrace` exists\n      Systrace.endEvent();\n    }\n    return _moduleObject.exports;\n  } catch (e) {\n    module.hasError = true;\n    module.error = e;\n    module.isInitialized = false;\n    module.publicModule.exports = undefined;\n    throw e;\n  } finally {\n    if (__DEV__) {\n      if (initializingModuleIds.pop() !== moduleId) {\n        throw new Error(\n          \"initializingModuleIds is corrupt; something is terribly wrong\"\n        );\n      }\n    }\n  }\n}\n\nfunction unknownModuleError(id) {\n  var message = 'Requiring unknown module \"' + id + '\".';\n  if (__DEV__) {\n    message +=\n      \"If you are sure the module is there, try restarting Metro Bundler. \" +\n      \"You may also want to run `yarn`, or `npm install` (depending on your environment).\";\n  }\n  return Error(message);\n}\n\nfunction moduleThrewError(id, error) {\n  var displayName = (__DEV__ && modules[id] && modules[id].verboseName) || id;\n  return Error(\n    'Requiring module \"' + displayName + '\", which threw an exception: ' + error\n  );\n}\n\nif (__DEV__) {\n  metroRequire.Systrace = {\n    beginEvent: function beginEvent() {},\n    endEvent: function endEvent() {}\n  };\n\n  metroRequire.getModules = function() {\n    return modules;\n  };\n\n  // HOT MODULE RELOADING\n  var createHotReloadingObject = function createHotReloadingObject() {\n    var hot = {\n      acceptCallback: null,\n      accept: function accept(callback) {\n        hot.acceptCallback = callback;\n      },\n      disposeCallback: null,\n      dispose: function dispose(callback) {\n        hot.disposeCallback = callback;\n      }\n    };\n    return hot;\n  };\n\n  var metroAcceptAll = function metroAcceptAll(\n    dependentModules,\n    inverseDependencies,\n    patchedModules\n  ) {\n    if (!dependentModules || dependentModules.length === 0) {\n      return true;\n    }\n\n    var notAccepted = dependentModules.filter(function(module) {\n      return !metroAccept(\n        module,\n        /*factory*/ undefined,\n        /*dependencyMap*/ undefined,\n        inverseDependencies,\n        patchedModules\n      );\n    });\n\n    var parents = [];\n    for (var i = 0; i < notAccepted.length; i++) {\n      // if the module has no parents then the change cannot be hot loaded\n      if (inverseDependencies[notAccepted[i]].length === 0) {\n        return false;\n      }\n\n      parents.push.apply(parents, inverseDependencies[notAccepted[i]]);\n    }\n\n    return parents.length == 0;\n  };\n\n  var metroAccept = function metroAccept(\n    id,\n    factory,\n    dependencyMap,\n    inverseDependencies\n  ) {\n    var patchedModules =\n      arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n\n    if (id in patchedModules) {\n      // Do not patch the same module more that once during an update.\n      return true;\n    }\n    patchedModules[id] = true;\n\n    var mod = modules[id];\n\n    if (!mod && factory) {\n      // New modules are going to be handled by the define() method.\n      return true;\n    }\n\n    var hot = mod.hot;\n\n    if (!hot) {\n      console.warn(\n        \"Cannot accept module because Hot Module Replacement \" +\n          \"API was not installed.\"\n      );\n      return false;\n    }\n\n    if (hot.disposeCallback) {\n      try {\n        hot.disposeCallback();\n      } catch (error) {\n        console.error(\n          \"Error while calling dispose handler for module \" + id + \": \",\n          error\n        );\n      }\n    }\n\n    // replace and initialize factory\n    if (factory) {\n      mod.factory = factory;\n    }\n    if (dependencyMap) {\n      mod.dependencyMap = dependencyMap;\n    }\n    mod.hasError = false;\n    mod.isInitialized = false;\n    metroRequire(id);\n\n    if (hot.acceptCallback) {\n      try {\n        hot.acceptCallback();\n        return true;\n      } catch (error) {\n        console.error(\n          \"Error while calling accept handler for module \" + id + \": \",\n          error\n        );\n      }\n    }\n\n    // need to have inverseDependencies to bubble up accept\n    if (!inverseDependencies) {\n      throw new Error(\"Undefined `inverseDependencies`\");\n    }\n\n    // accept parent modules recursively up until all siblings are accepted\n    return metroAcceptAll(\n      inverseDependencies[id],\n      inverseDependencies,\n      patchedModules\n    );\n  };\n\n  global.__accept = metroAccept;\n}\n","/**\n * Copyright 2018-present Facebook.\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n * @format\n * @flow\n */\n\nimport {\n  FlipperDevicePlugin,\n  Device,\n  View,\n  styled,\n  FlexColumn,\n  FlexRow,\n  ContextMenu,\n  clipboard,\n  Button,\n  FlipperPlugin,\n  getPluginKey,\n  getPersistedState,\n  BaseDevice,\n  shouldParseAndroidLog,\n  StackTrace,\n  Text,\n  colors,\n  Toolbar,\n  Spacer,\n  Select,\n} from 'flipper';\nimport unicodeSubstring from 'unicode-substring';\nimport fs from 'fs';\nimport os from 'os';\nimport util from 'util';\nimport path from 'path';\nimport type {Notification} from '../../plugin';\nimport type {Store, DeviceLogEntry, OS, Props} from 'flipper';\nimport {Component} from 'react';\n\ntype HeaderRowProps = {\n  title: string,\n  value: string,\n};\ntype openLogsCallbackType = () => void;\n\ntype CrashReporterBarProps = {|\n  openLogsCallback?: openLogsCallbackType,\n  crashSelector: CrashSelectorProps,\n|};\n\ntype CrashSelectorProps = {|\n  crashes: ?{[key: string]: string},\n  orderedIDs: ?Array<string>,\n  selectedCrashID: ?string,\n  onCrashChange: ?(string) => void,\n|};\n\nexport type Crash = {|\n  notificationID: string,\n  callstack: string,\n  reason: string,\n  name: string,\n  date: Date,\n|};\n\nexport type CrashLog = {|\n  callstack: string,\n  reason: string,\n  name: string,\n  date: ?Date,\n|};\n\nexport type PersistedState = {\n  crashes: Array<Crash>,\n};\n\ntype State = {\n  crash: ?Crash,\n};\n\nconst Padder = styled('div')(\n  ({paddingLeft, paddingRight, paddingBottom, paddingTop}) => ({\n    paddingLeft: paddingLeft || 0,\n    paddingRight: paddingRight || 0,\n    paddingBottom: paddingBottom || 0,\n    paddingTop: paddingTop || 0,\n  }),\n);\n\nconst Title = styled(Text)({\n  fontWeight: 'bold',\n  color: colors.greyTint3,\n  height: 'auto',\n  width: 200,\n  textOverflow: 'ellipsis',\n});\n\nconst Line = styled(View)({\n  backgroundColor: colors.greyTint2,\n  height: 1,\n  width: 'auto',\n  marginTop: 2,\n  flexShrink: 0,\n});\n\nconst Container = styled(FlexColumn)({\n  overflow: 'hidden',\n  flexShrink: 0,\n});\n\nconst Value = styled(Title)({\n  maxHeight: 200,\n  height: 'auto',\n  flexGrow: 1,\n});\n\nconst FlexGrowColumn = styled(FlexColumn)({\n  flexGrow: 1,\n});\n\nconst ScrollableColumn = styled(FlexGrowColumn)({\n  overflow: 'scroll',\n  height: 'auto',\n});\n\nconst StyledFlexGrowColumn = styled(FlexColumn)({\n  flexGrow: 1,\n});\n\nconst StyledFlexRowColumn = styled(FlexRow)({\n  aligItems: 'center',\n  justifyContent: 'center',\n  height: '100%',\n});\n\nconst StyledFlexColumn = styled(StyledFlexGrowColumn)({\n  justifyContent: 'center',\n  alignItems: 'center',\n});\n\nconst MatchParentHeightComponent = styled(FlexRow)({\n  height: '100%',\n});\n\nconst ButtonGroupContainer = styled(FlexRow)({\n  paddingLeft: 4,\n  paddingTop: 2,\n  paddingBottom: 2,\n  height: '100%',\n});\n\nconst StyledSelectContainer = styled(FlexRow)({\n  paddingLeft: 8,\n  paddingTop: 2,\n  paddingBottom: 2,\n  height: '100%',\n});\n\nconst StyledSelect = styled(Select)({\n  height: '100%',\n  maxWidth: 200,\n});\n\nexport function getNewPersisitedStateFromCrashLog(\n  persistedState: ?PersistedState,\n  persistingPlugin: Class<FlipperDevicePlugin<> | FlipperPlugin<>>,\n  content: string,\n  os: ?OS,\n  logDate: ?Date,\n): ?PersistedState {\n  const persistedStateReducer = persistingPlugin.persistedStateReducer;\n  if (!os || !persistedStateReducer) {\n    return null;\n  }\n  const crash = parseCrashLog(content, os, logDate);\n  const newPluginState = persistedStateReducer(\n    persistedState,\n    'crash-report',\n    crash,\n  );\n  return newPluginState;\n}\n\nexport function parseCrashLogAndUpdateState(\n  store: Store,\n  content: string,\n  setPersistedState: (\n    pluginKey: string,\n    newPluginState: ?PersistedState,\n  ) => void,\n  logDate: ?Date,\n) {\n  const os = store.getState().connections.selectedDevice?.os;\n  if (\n    !shouldShowCrashNotification(\n      store.getState().connections.selectedDevice,\n      content,\n      os,\n    )\n  ) {\n    return;\n  }\n  const pluginID = CrashReporterPlugin.id;\n  const pluginKey = getPluginKey(\n    null,\n    store.getState().connections.selectedDevice,\n    pluginID,\n  );\n  const persistingPlugin: ?Class<\n    FlipperDevicePlugin<> | FlipperPlugin<>,\n  > = store.getState().plugins.devicePlugins.get(CrashReporterPlugin.id);\n  if (!persistingPlugin) {\n    return;\n  }\n  const pluginStates = store.getState().pluginStates;\n  const persistedState = getPersistedState(\n    pluginKey,\n    persistingPlugin,\n    pluginStates,\n  );\n  const newPluginState = getNewPersisitedStateFromCrashLog(\n    persistedState,\n    persistingPlugin,\n    content,\n    os,\n    logDate,\n  );\n  setPersistedState(pluginKey, newPluginState);\n}\n\nexport function shouldShowCrashNotification(\n  baseDevice: ?BaseDevice,\n  content: string,\n  os: ?OS,\n): boolean {\n  if (os && os === 'Android') {\n    return true;\n  }\n  const appPath = parsePath(content);\n  const serial: string = baseDevice?.serial || 'unknown';\n  if (!appPath || !appPath.includes(serial)) {\n    // Do not show notifications for the app which are not the selected one\n    return false;\n  }\n  return true;\n}\n\nexport function parseCrashLog(\n  content: string,\n  os: OS,\n  logDate: ?Date,\n): CrashLog {\n  const stubString = 'Cannot figure out the cause';\n  switch (os) {\n    case 'iOS': {\n      const regex = /Exception Type: *[\\w]*/;\n      const arr = regex.exec(content);\n      const exceptionString = arr ? arr[0] : '';\n      const exceptionRegex = /[\\w]*$/;\n      const tmp = exceptionRegex.exec(exceptionString);\n      const exception =\n        tmp && tmp[0].length ? tmp[0] : 'Cannot figure out the cause';\n\n      let date = logDate;\n      if (!date) {\n        const dateRegex = /Date\\/Time: *[\\w\\s\\.:-]*/;\n        const dateArr = dateRegex.exec(content);\n        const dateString = dateArr ? dateArr[0] : '';\n        const dateRegex2 = /[\\w\\s\\.:-]*$/;\n        const tmp1 = dateRegex2.exec(dateString);\n        const extractedDateString: ?string =\n          tmp1 && tmp1[0].length ? tmp1[0] : null;\n        date = extractedDateString ? new Date(extractedDateString) : logDate;\n      }\n\n      const crash = {\n        callstack: content,\n        name: exception,\n        reason: exception,\n        date,\n      };\n      return crash;\n    }\n    case 'Android': {\n      const regForName = /.*\\n/;\n      const nameRegArr = regForName.exec(content);\n      let name = nameRegArr ? nameRegArr[0] : stubString;\n      const regForCallStack = /\\tat[\\w\\s\\n.$&+,:;=?@#|'<>.^*()%!-]*$/;\n      const callStackArray = regForCallStack.exec(content);\n      const callStack = callStackArray ? callStackArray[0] : '';\n      let remainingString =\n        callStack.length > 0 ? content.replace(callStack, '') : '';\n      if (remainingString[remainingString.length - 1] === '\\n') {\n        remainingString = remainingString.slice(0, -1);\n      }\n      const reason =\n        remainingString.length > 0\n          ? remainingString.split('\\n').pop()\n          : stubString;\n      if (name[name.length - 1] === '\\n') {\n        name = name.slice(0, -1);\n      }\n      const crash = {\n        callstack: content,\n        name: name,\n        reason: reason,\n        date: logDate,\n      };\n      return crash;\n    }\n    default: {\n      throw new Error('Unsupported OS');\n    }\n  }\n}\n\nfunction truncate(baseString: string, numOfChars: number): string {\n  if (baseString.length <= numOfChars) {\n    return baseString;\n  }\n  const truncated_string = unicodeSubstring(baseString, 0, numOfChars - 1);\n  return truncated_string + '\\u2026';\n}\n\nexport function parsePath(content: string): ?string {\n  const regex = /Path: *[\\w\\-\\/\\.\\t\\ \\_\\%]*\\n/;\n  const arr = regex.exec(content);\n  if (!arr || arr.length <= 0) {\n    return null;\n  }\n  const pathString = arr[0];\n  const pathRegex = /[\\w\\-\\/\\.\\t\\ \\_\\%]*\\n/;\n  const tmp = pathRegex.exec(pathString);\n  if (!tmp || tmp.length == 0) {\n    return null;\n  }\n  const path = tmp[0];\n  return path.trim();\n}\n\nfunction addFileWatcherForiOSCrashLogs(\n  store: Store,\n  setPersistedState: (\n    pluginKey: string,\n    newPluginState: ?PersistedState,\n  ) => void,\n) {\n  const dir = path.join(os.homedir(), 'Library', 'Logs', 'DiagnosticReports');\n  if (!fs.existsSync(dir)) {\n    // Directory doesn't exist\n    return;\n  }\n  fs.watch(dir, (eventType, filename) => {\n    // We just parse the crash logs with extension `.crash`\n    const checkFileExtension = /.crash$/.exec(filename);\n    if (!filename || !checkFileExtension) {\n      return;\n    }\n    fs.readFile(path.join(dir, filename), 'utf8', function(err, data) {\n      if (store.getState().connections.selectedDevice?.os != 'iOS') {\n        // If the selected device is not iOS don't show crash notifications\n        return;\n      }\n      if (err) {\n        console.error(err);\n        return;\n      }\n      parseCrashLogAndUpdateState(store, util.format(data), setPersistedState);\n    });\n  });\n}\n\nclass CrashSelector extends Component<CrashSelectorProps> {\n  render() {\n    const {crashes, selectedCrashID, orderedIDs, onCrashChange} = this.props;\n    return (\n      <StyledFlexRowColumn>\n        <ButtonGroupContainer>\n          <MatchParentHeightComponent>\n            <Button\n              disabled={Boolean(!orderedIDs || orderedIDs.length <= 1)}\n              compact={true}\n              onClick={() => {\n                if (onCrashChange && orderedIDs) {\n                  const index = orderedIDs.indexOf(selectedCrashID);\n                  const nextIndex =\n                    index < 1 ? orderedIDs.length - 1 : index - 1;\n                  const nextID = orderedIDs[nextIndex];\n                  onCrashChange(nextID);\n                }\n              }}\n              icon=\"chevron-left\"\n              iconSize={12}\n              title=\"Previous Crash\"\n            />\n          </MatchParentHeightComponent>\n          <MatchParentHeightComponent>\n            <Button\n              disabled={Boolean(!orderedIDs || orderedIDs.length <= 1)}\n              compact={true}\n              onClick={() => {\n                if (onCrashChange && orderedIDs) {\n                  const index = orderedIDs.indexOf(selectedCrashID);\n                  const nextIndex =\n                    index >= orderedIDs.length - 1 ? 0 : index + 1;\n                  const nextID = orderedIDs[nextIndex];\n                  onCrashChange(nextID);\n                }\n              }}\n              icon=\"chevron-right\"\n              iconSize={12}\n              title=\"Next Crash\"\n            />\n          </MatchParentHeightComponent>\n        </ButtonGroupContainer>\n        <StyledSelectContainer>\n          <StyledSelect\n            grow={true}\n            selected={selectedCrashID || 'NoCrashID'}\n            options={crashes || {NoCrashID: 'No Crash'}}\n            onChange={(title: string) => {\n              for (const key in crashes) {\n                if (crashes[key] === title && onCrashChange) {\n                  onCrashChange(key);\n                  return;\n                }\n              }\n            }}\n          />\n        </StyledSelectContainer>\n      </StyledFlexRowColumn>\n    );\n  }\n}\n\nclass CrashReporterBar extends Component<CrashReporterBarProps> {\n  render() {\n    const {openLogsCallback, crashSelector} = this.props;\n    return (\n      <Toolbar>\n        <CrashSelector {...crashSelector} />\n        <Spacer />\n        <Button\n          disabled={Boolean(!openLogsCallback)}\n          onClick={openLogsCallback}>\n          Open In Logs\n        </Button>\n      </Toolbar>\n    );\n  }\n}\n\nclass HeaderRow extends Component<HeaderRowProps> {\n  render() {\n    const {title, value} = this.props;\n    return (\n      <Padder paddingTop={8} paddingBottom={2}>\n        <Container>\n          <Padder paddingLeft={8}>\n            <FlexRow>\n              <Title>{title}</Title>\n              <ContextMenu\n                items={[\n                  {\n                    label: 'copy',\n                    click: () => {\n                      clipboard.writeText(value);\n                    },\n                  },\n                ]}>\n                <Value code={true}>{value}</Value>\n              </ContextMenu>\n            </FlexRow>\n          </Padder>\n          <Line />\n        </Container>\n      </Padder>\n    );\n  }\n}\n\nexport default class CrashReporterPlugin extends FlipperDevicePlugin<\n  State,\n  void,\n  PersistedState,\n> {\n  static defaultPersistedState = {crashes: []};\n\n  static supportsDevice(device: Device) {\n    return device.os === 'iOS' || device.os === 'Android';\n  }\n\n  static notificationID: number = 0;\n  /*\n   * Reducer to process incoming \"send\" messages from the mobile counterpart.\n   */\n  static persistedStateReducer = (\n    persistedState: PersistedState,\n    method: string,\n    payload: Object,\n  ): PersistedState => {\n    if (method === 'crash-report' || method === 'flipper-crash-report') {\n      CrashReporterPlugin.notificationID++;\n      const mergedState: PersistedState = {\n        crashes: persistedState.crashes.concat([\n          {\n            notificationID: CrashReporterPlugin.notificationID.toString(), // All notifications are unique\n            callstack: payload.callstack,\n            name: payload.name,\n            reason: payload.reason,\n            date: payload.date || new Date(),\n          },\n        ]),\n      };\n      return mergedState;\n    }\n    return persistedState;\n  };\n\n  static trimCallStackIfPossible = (callstack: string): string => {\n    let regex = /Application Specific Information:/;\n    const query = regex.exec(callstack);\n    return query ? callstack.substring(0, query.index) : callstack;\n  };\n  /*\n   * Callback to provide the currently active notifications.\n   */\n  static getActiveNotifications = (\n    persistedState: PersistedState,\n  ): Array<Notification> => {\n    return persistedState.crashes.map((crash: Crash) => {\n      const id = crash.notificationID;\n      const title = `CRASH: ${truncate(crash.name, 50)} Reason: ${truncate(\n        crash.reason,\n        50,\n      )}`;\n      const callstack = CrashReporterPlugin.trimCallStackIfPossible(\n        crash.callstack,\n      );\n      const msg = `Callstack: ${truncate(callstack, 200)}`;\n      return {\n        id,\n        message: msg,\n        severity: 'error',\n        title: title,\n        action: id,\n      };\n    });\n  };\n\n  /*\n   * This function gets called whenever the device is registered\n   */\n  static onRegisterDevice = (\n    store: Store,\n    baseDevice: BaseDevice,\n    setPersistedState: (\n      pluginKey: string,\n      newPluginState: ?PersistedState,\n    ) => void,\n  ): void => {\n    if (baseDevice.os.includes('iOS')) {\n      addFileWatcherForiOSCrashLogs(store, setPersistedState);\n    } else {\n      const referenceDate = new Date();\n      (function(\n        store: Store,\n        date: Date,\n        setPersistedState: (\n          pluginKey: string,\n          newPluginState: ?PersistedState,\n        ) => void,\n      ) {\n        let androidLog: string = '';\n        let androidLogUnderProcess = false;\n        let timer = null;\n        baseDevice.addLogListener((entry: DeviceLogEntry) => {\n          if (shouldParseAndroidLog(entry, referenceDate)) {\n            if (androidLogUnderProcess) {\n              androidLog += '\\n' + entry.message;\n              androidLog = androidLog.trim();\n              if (timer) {\n                clearTimeout(timer);\n              }\n            } else {\n              androidLog = entry.message;\n              androidLogUnderProcess = true;\n            }\n            timer = setTimeout(() => {\n              if (androidLog.length > 0) {\n                parseCrashLogAndUpdateState(\n                  store,\n                  androidLog,\n                  setPersistedState,\n                  entry.date,\n                );\n              }\n              androidLogUnderProcess = false;\n              androidLog = '';\n            }, 50);\n          }\n        });\n      })(store, referenceDate, setPersistedState);\n    }\n  };\n  openInLogs = (callstack: string) => {\n    this.props.selectPlugin('DeviceLogs', callstack);\n  };\n\n  constructor(props: Props<PersistedState>) {\n    // Required step: always call the parent class' constructor\n    super(props);\n    let crash: ?Crash = null;\n    if (\n      this.props.persistedState.crashes &&\n      this.props.persistedState.crashes.length > 0\n    ) {\n      crash = this.props.persistedState.crashes[\n        this.props.persistedState.crashes.length - 1\n      ];\n    }\n\n    let deeplinkedCrash = null;\n    if (this.props.deepLinkPayload) {\n      const id = this.props.deepLinkPayload;\n      const index = this.props.persistedState.crashes.findIndex(elem => {\n        return elem.notificationID === id;\n      });\n      if (index >= 0) {\n        deeplinkedCrash = this.props.persistedState.crashes[index];\n      }\n    }\n    // Set the state directly. Use props if necessary.\n    this.state = {\n      crash: deeplinkedCrash || crash,\n    };\n  }\n\n  render() {\n    let crashToBeInspected = this.state.crash;\n\n    if (!crashToBeInspected && this.props.persistedState.crashes.length > 0) {\n      crashToBeInspected = this.props.persistedState.crashes[\n        this.props.persistedState.crashes.length - 1\n      ];\n    }\n    const crash = crashToBeInspected;\n    if (crash) {\n      const {crashes} = this.props.persistedState;\n      const crashMap = crashes.reduce(\n        (acc: {[key: string]: string}, persistedCrash: Crash) => {\n          const {notificationID, date} = persistedCrash;\n          const name = 'Crash at ' + date.toLocaleString();\n          acc[notificationID] = name;\n          return acc;\n        },\n        {},\n      );\n\n      const orderedIDs = crashes.map(\n        persistedCrash => persistedCrash.notificationID,\n      );\n      const selectedCrashID = crash.notificationID;\n      const onCrashChange = id => {\n        const newSelectedCrash = crashes.find(element => {\n          return element.notificationID === id;\n        });\n        this.setState({crash: newSelectedCrash});\n        console.log('onCrashChange called', id);\n      };\n      const callstackString = crash.callstack;\n\n      const children = crash.callstack.split('\\n').map(str => {\n        return {message: str};\n      });\n      const crashSelector: CrashSelectorProps = {\n        crashes: crashMap,\n        orderedIDs,\n        selectedCrashID,\n        onCrashChange,\n      };\n      return (\n        <FlexColumn>\n          {this.device.os == 'Android' ? (\n            <CrashReporterBar\n              crashSelector={crashSelector}\n              openLogsCallback={() => {\n                this.openInLogs(crash.callstack);\n              }}\n            />\n          ) : (\n            <CrashReporterBar crashSelector={crashSelector} />\n          )}\n          <ScrollableColumn>\n            <HeaderRow title=\"Name\" value={crash.name} />\n            <HeaderRow title=\"Reason\" value={crash.reason} />\n            <Padder paddingLeft={8} paddingTop={4} paddingBottom={2}>\n              <Title> Stacktrace </Title>\n            </Padder>\n            <ContextMenu\n              items={[\n                {\n                  label: 'copy',\n                  click: () => {\n                    clipboard.writeText(callstackString);\n                  },\n                },\n              ]}>\n              <Line />\n              <StackTrace\n                children={children}\n                isCrash={false}\n                padded={false}\n                backgroundColor={colors.greyStackTraceTint}\n              />\n            </ContextMenu>\n          </ScrollableColumn>\n        </FlexColumn>\n      );\n    }\n    const crashSelector = {\n      crashes: null,\n      orderedIDs: null,\n      selectedCrashID: null,\n      onCrashChange: null,\n    };\n    return (\n      <StyledFlexGrowColumn>\n        <CrashReporterBar crashSelector={crashSelector} />\n        <StyledFlexColumn>\n          <Padder paddingBottom={8}>\n            <Title>No Crashes Logged</Title>\n          </Padder>\n        </StyledFlexColumn>\n      </StyledFlexGrowColumn>\n    );\n  }\n}\n","function charAt(string, index) {\n  var first = string.charCodeAt(index);\n  var second;\n  if (first >= 0xD800 && first <= 0xDBFF && string.length > index + 1) {\n    second = string.charCodeAt(index + 1);\n    if (second >= 0xDC00 && second <= 0xDFFF) {\n      return string.substring(index, index + 2);\n    }\n  }\n  return string[index];\n}\n\nfunction slice(string, start, end) {\n  var accumulator = \"\";\n  var character;\n  var stringIndex = 0;\n  var unicodeIndex = 0;\n  var length = string.length;\n\n  while (stringIndex < length) {\n    character = charAt(string, stringIndex);\n    if (unicodeIndex >= start && unicodeIndex < end) {\n      accumulator += character;\n    }\n    stringIndex += character.length;\n    unicodeIndex += 1;\n  }\n  return accumulator;\n}\n\nfunction toNumber(value, fallback) {\n  if (value === undefined) {\n    return fallback;\n  } else {\n    return Number(value);\n  }\n}\n\nmodule.exports = function (string, start, end) {\n  var realStart = toNumber(start, 0);\n  var realEnd = toNumber(end, string.length);\n  if (realEnd == realStart) {\n    return \"\";\n  } else if (realEnd > realStart) {\n    return slice(string, realStart, realEnd);\n  } else {\n    return slice(string, realEnd, realStart);\n  }\n}\n"],"names":["global","__r","metroRequire","__d","define","__c","clear","modules","EMPTY","_ref","hasOwnProperty","__NUM_MODULES__","Array","Object","create","factory","moduleId","dependencyMap","hasError","importedAll","importedDefault","isInitialized","publicModule","exports","moduleIdReallyIsNumber","module","guardedLoadModule","metroImportDefault","__esModule","default","metroImportAll","_key","call","inGuard","ErrorUtils","returnValue","loadModuleImplementation","e","reportFatalError","ID_MASK_SHIFT","LOCAL_ID_MASK","unpackModuleId","segmentId","localId","packModuleId","value","hooks","registerHook","cb","hook","push","release","i","length","splice","__defineModule","nativeRequire","_unpackModuleId","_segmentId","_localId","unknownModuleError","moduleThrewError","error","_module","_moduleObject","id","undefined","message","Error","displayName","Padder","paddingLeft","paddingRight","paddingBottom","paddingTop","Title","Text","fontWeight","color","colors","greyTint3","height","width","textOverflow","Line","View","backgroundColor","greyTint2","marginTop","flexShrink","Container","FlexColumn","overflow","Value","maxHeight","flexGrow","FlexGrowColumn","ScrollableColumn","StyledFlexGrowColumn","StyledFlexRowColumn","FlexRow","aligItems","justifyContent","StyledFlexColumn","alignItems","MatchParentHeightComponent","ButtonGroupContainer","StyledSelectContainer","StyledSelect","Select","maxWidth","getNewPersisitedStateFromCrashLog","persistedState","persistingPlugin","content","os","logDate","persistedStateReducer","crash","parseCrashLog","newPluginState","parseCrashLogAndUpdateState","store","setPersistedState","getState","connections","selectedDevice","shouldShowCrashNotification","pluginID","CrashReporterPlugin","pluginKey","plugins","devicePlugins","get","pluginStates","baseDevice","appPath","parsePath","serial","includes","stubString","regex","arr","exec","exceptionString","exceptionRegex","tmp","exception","date","dateRegex","dateArr","dateString","dateRegex2","tmp1","extractedDateString","Date","callstack","name","reason","regForName","nameRegArr","regForCallStack","callStackArray","callStack","remainingString","replace","slice","split","pop","truncate","baseString","numOfChars","truncated_string","pathString","pathRegex","path","trim","addFileWatcherForiOSCrashLogs","dir","join","homedir","fs","existsSync","watch","eventType","filename","checkFileExtension","readFile","err","data","console","util","format","CrashSelector","Component","render","crashes","selectedCrashID","orderedIDs","onCrashChange","props","Boolean","index","indexOf","nextIndex","nextID","NoCrashID","title","key","CrashReporterBar","openLogsCallback","crashSelector","HeaderRow","label","click","clipboard","writeText","FlipperDevicePlugin","supportsDevice","device","constructor","selectPlugin","deeplinkedCrash","deepLinkPayload","findIndex","elem","notificationID","state","crashToBeInspected","crashMap","reduce","acc","persistedCrash","toLocaleString","map","newSelectedCrash","find","element","setState","log","callstackString","children","str","openInLogs","greyStackTraceTint","method","payload","mergedState","concat","toString","query","substring","trimCallStackIfPossible","msg","severity","action","referenceDate","androidLog","androidLogUnderProcess","timer","addLogListener","entry","clearTimeout","setTimeout","charAt","string","first","charCodeAt","second","start","end","accumulator","character","stringIndex","unicodeIndex","toNumber","fallback","Number","realStart","realEnd"],"mappings":"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"}